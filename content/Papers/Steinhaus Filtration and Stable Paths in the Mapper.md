---
id: Steinhaus Filtration and Stable Paths in the Mapper
aliases: 
tags:
  - papers
date: 2024-04-02
---

**Questions:**
- What is the problem we are trying to solve?
- What does the "birth time" of a simplex $\sigma$ mean?
*Answer:* Smallest time $t$ such that $\sigma$ is created in the filtration.
- How to pick the intervals for Mapper construction?
- How to visualize bottleneck metric on covers?
- How does interleaved filtration relate to stability?
- Why does an isomorphism between the 1-skeleton of VR and cover imply isomorphism between filtrations?
- How to interpret Pareto frontiers?

Full paper can be found at: https://arxiv.org/abs/1906.08256.

# Introduction

Two important concepts in TDA are [[Persistent Homology|persistentence]] and the Mapper construction.

It is typically unclear as to how one should interpret higher dimensional homology. One method is via persistence diagrams. 

In most TDA applications we are under the assumption that the data has a metric. However, assigning a meaningful metric is not always clear, e.g., Netflix movie recommendations.

Mapper construction is defined to be the nerve of a cover of data: 

![[SS_2024-03-08_1709943173.png#invert]]

We begin with a set of overlapping intervals covering the possible values of some parameter (shown here as the $y$-axis). Next we cluster the data set such that each cluster falls into an interval. We then take the nerve of the clusters.

The full algorithm is given [[2024-03-19 | here]].

The choice of intervals may drastically affect the resulting complex. For example, consider the two constructions below:

![[SS_2024-03-08_1709944069.png#invert]]

By slightly shrinking an interval, the single point that was in both yellow and cyan regions is now no longer in the yellow region. This results in the yellow-cyan edge in the nerve being removed. From a path perspective, the path from yellow to cyan goes from one edge to six edges.

# Cover Filtrations

We construct a filtration given by a distance on covers.

> [!def] Steinhaus Distance
> Given a measure $\mu$, the **Steinhaus distance** between two sets $A$ and $B$ is 
> $$
>   d_{St}(A,B) = 1 - \frac{\mu(A\cap B)}{\mu(A\cup B)} = \frac{\mu(A\cup B)-\mu(A\cap B)}{\mu(A\cup B)}. 
> $$

The Steinhaus distance is bounded on $[0,1]$ and is based on the [Jaccard distance](https://en.wikipedia.org/wiki/Jaccard_index). Indeed, since $A\cap B\subseteq A\cup B$, the ratio of measures is between 0 and 1. In a sense, the Steinhaus distance measures "how little" the two sets intersect. When they don't intersect at all, we get a distance of one. When $A=B$, the distance is zero.

Naturally, this can be extended to a collection of sets:
$$
    \mu_{St}(\{U_i\}) = 1 - \frac{\mu(\bigcap U_i)}{\mu(\bigcup U_i)}.
$$

When constructing the nerve of our cover, we keep track of the Steinhaus distance.

> [!def] Steinhaus Nerve
> The **Steinhaus nerve** of a cover $\cal{U}$, denoted $\textup{Nrv}_{St}(\cal{U})$, is the nerve of $\cal{U}$ where each simplex is assigned a weight given by
> $$
>   w_\sigma = d_{St}(\{U_i\in\cal{U}|i\in\sigma\}).
> $$

We claim that $w_\tau\le w_\sigma$ whenever $\tau\preceq\sigma$. Notice that if $\tau\preceq\sigma$ and $\sigma$ is generated from the cover $\{U_i\}_{i\in I}$, then $\tau$ must be generated by the subcover $\{U_i\}_{i\in J}$, $J\subset I$. Thus, when taking the unions and intersections:
$$
    \mu\left(\bigcap_{i\in J}U_i\right) \ge \mu\left(\bigcap_{i\in I}U_i\right)~\text{ and }~
    \mu\left(\bigcup_{i\in J}U_i\right) \le \mu\left(\bigcup_{i\in I}U_i\right).
$$

As a result we get the filtration
$$
    \emptyset = K^{t_0} \subset K^{t_1} \subset K^{t_2} \subseteq \dots
$$
where $K^{t_i}:=\{\sigma\in\textup{Nrv}_{St}(\cal{U})\mid w_\sigma\le t_i\}$ for $t_i\in[0,1]$.

This construction can have upto $2^{|\cal{U}|}-1$ vertices and dimension $|\cal{U}|-1$. Computationally, we need to compute the volume of both intersections an unions of sets. If $C_\text{Unn}$ and $C_\text{Int}$ are the computational cost of computing the volumes of unions and intersections, respectively, then each simplex costs $C_\text{Unn}+C_\text{Int}$. Resulting in a worst-case scenario of $(C_\text{Unn}+C_\text{Int})(2^{|\cal{U}|}-1)$. 

# Stability

We focus on stability in terms of changes in the cover.

> [!def] Bottleneck metric on covers
> Let $\cal{U}$ and $\cal{V}$ be two finite covers of a finite set $X$ such that $|\cal{U}|=|\cal{V}|$. Let $\cal{M}(\cal{U},\cal{V})$ be the set of all possible matchings. Then the **bottleneck distance** between two covers is defined as 
> $$
>   d_B(\cal{U},\cal{V}) = \min_{M\in\cal{M}(\cal{U},\cal{V})}\left\{\max_{(U,V)\in M}\mu(U\Delta V)\right\}
> $$
> where $\Delta$ is the [[Symmetric Difference|symmetric difference]].

One may verify that $d_B$ is a metric on the space of finite covers of a finite set.

The following theorem, shows that for two covers of the same size, the Steinhaus nerve are *$\alpha/m$ interleaved*, i.e.,
$$
    d_{St}(V_I)-\frac{\alpha}{m}\le d_{St}(U_I) \le d_{St}(V_I) + \frac{\alpha}{m}
$$
where $V_I\subset\cal{V}$ and $U_I\subset\cal{U}$.

> [!thm] 
> Suppose that $\cal{U}=\{U_i\}$ and $\cal{V}=\{V_i\}$ are two covers of $X$ with $|\cal{U}|=|\cal{V}|$ and $d_B(\cal{U},\cal{V})\le\alpha$. Given $m=\min\{\min_{U\in\cal{U}}\mu(U),\min_{V\in\cal{V}}\mu(V)\}$, $\textup{Nrv}_{St}(\cal{U})$ and $\textup{Nrv}_{St}(\cal{V})$ are $\alpha/m$ interleaved filtrations.

The idea of the theorem is the following question: what is the largest change in Steinhaus distance possible between collections $U_I$ and $V_J$?

When $|\cal{U}|>|\cal{V}|$, then there is some vertex $v\in\textup{Nrv}_{St}(\cal{U})$ not present in $\textup{Nrv}_{St}(\cal{V})$. As a result they cannot be interleaved.

# Equivalence

Let $\text{\v{C}}_r(X)$ be the cover of $X$ by balls of radius $r$. Then the Cech complex is the nerve of this cover. The Cech filtration is the sequence of complexes given by letting $r\rightarrow\infty$.

**Conjecture**: Given finite $X\subset\R^n$ and $R>\textup{diam}(X)$, the Cech filtration is isomorphic to the Steinhaus filtration constructed from $\text{\v{C}}_R(x)$ under the Lebesgue measure.

The paper starts with proving there is a bijection between $n$-skeletons in the 1-dimensional case. See daily entry [[2024-03-29]] for details. The bijection is given by
$$
    C(\{v_i\}) = \frac{Rd_{St}(\{V_i\})}{2-d_{St}(\{V_i\})}
$$
where $C(\{v_i\})$ is the Cech birth radius of the simplex defined by vertices $\{v_i\}$ and $\{V_i\}$ is the set of $R$-balls centered at each vertex $\{v_i\}$.

The paper then moves on to the 1-skeleton in any arbitrary dimension. Notice that if the 1-skeletons of the two constructions are isomorphic, then the cover filtration is isomorphic to the Vietoris-Rips filtration since VR is formed by initially finding the 1-skeleton of the Cech complex.

> [!lemma]
> The Vietoris-Rips filtration completely determines the cover filtration in arbitrary dimensions.

While the paper doesn't provide a bijection between the two, they do provide a mapping from the birth time of edges in the Cech filtration to birth time of edges in the cover filtration. More specifically, this map is given by the Steinhaus distance (with Lebesgue measure) of two spheres in $\R^n$ with radius $R$ that have a Euclidean distance of $d$:
$$
    d_{St}^n(R,d) = \frac{2V_\circ^n(R) - 2_\cap^n(R,d)}{2V_\circ^n(R)-V_\cap^n(R,d)}
$$
where $V_\circ^n(R)$ is the volume of a hypersphere of radius $R$ and $V_\cap^n(R,d)$ is the volume of intersection between two hyperspheres both with radius $R$ whose centers have distance $d$. Both terms involve the gamma function and are messy to compute. The term $V_\cap^n(R,d)$ was derived by Li in 2011.

The paper does not demonstrate that this mapping is bijective, and the existence of an inverse is not clear from the map. However, the existence of the map does suggest we can derive the cover filtration from the VR filtration. More precisely, once the VR filtration is constructed, we can construct the cover filtration by evaluating $d_{St}^n(R,d)$ given above for each radius $R$ in the VR filtration.

While the conjecture was not definitely proven, experimental results are given that reinforce the validity of the claim:

![[SS_2024-04-02_1712092634.png#invert | center]]

The left most plot shows a uniform data set of 20,000 points with 50 sampled landmark points. The middle plot gives the persistence diagram of dimensions 0 and 1 for the VR filtration. Whereas the right plot gives an approximated persitence diagrams (dimensions 0 and 1) for the Steinhaus filtration based on the landmarks. The selected cover was balls of radii 0.5.

The two persistence diagrams have minimal differences, which is to be expected if the conjecture holds true as the Steinhaus filtration is approximated.

# Stable Paths

We want a method to find "stable" paths in the 1-skeleton of a cover filtration. That is, paths with the least distance. That is, the Steinhaus distance. This differs from the shortest path which would be the path with fewest edges.

> [!def] $\rho$-Stable path
> Given a Steinhaus distance $\rho$, a path $P$ is defined to $\rho$-**stable** if
> $$
>   \max\{d_{St}(e)\mid e\in P\}\le\rho. 
> $$

In other words, a path is $\rho$-stable if each step along the path is at most $\rho$ far. Clearly, if $\rho_1\le \rho_2$ then a $\rho_1$-stable path is also $\rho_2$-stable. Moreover, when $\rho_1<\rho_2$, then we have a higher confidence that a $\rho_1$-stable path $P_1$ is not due to noise than a less stable $\rho_2$-stable path $P_2$. We want to find the maximally stable paths between two vertices.

> [!def] Maximally Stable Path
> Given a pair of vertices $s$ and $t$, a **maximally stable s-t path** is a $\rho$-stable path between $s$ and $t$ for the smallest value of $\rho$. In the case of multiple s-t paths with the same minimum $\rho$-value, the shortest of the paths is used.

Finding the maximally stable path is a [minimax](https://en.wikipedia.org/wiki/Minimax) path problem on undirected graphs. That is, we want to minimize the maximum edge weight. See daily note [[2024-04-02]] for more details.

There are two paths of relevant: the shortest path, and the most stable. We want to compare the two by computing the Pareto frontier between the two paths:

![[SS_2024-04-02_1712095858.png#invert | center]]

We repeatedly compute the shortest path (orange dots above) while keeping track of the cheapest known path and removing all edges with distance larger than $\rho$.

```
Input: 1-skeleton G of cover filtration and vertices s,t

set LIST = [] // stores path P and cost p pairs
while s and t are connected in G:
    compute shortest path P between s and t
    set p = max edge distance in P

    if LIST has no path P' where |P|=|P'|:
        add (P,p) to LIST
    else if p < p' for path (P',p') in LIST where |P|=|P'|:
        replace (P',p') with (P,p) in LIST

    remove all edges e from G with distance >= p
```

# Application: Recommendation Systems

Consider the following question: *What movies should I show my friend first, to wean them into my favorite movie?*
